Мотивация

* Кеширование редко меняющихся данных снижает нагрузку на бэкенд и улучшает отзывчивость интерфейса (статику не нужно повторно грузить по сети, используется локальный кэш)
* Снижение нагрузки на БД
* Увеличение скорости ответа бэкенда (дашборд операторов) за счет использования read-/write-through кеширования.

Предлагаемое решение

Можно настроить CDN поверх s3-хранилища для ускорения загрузки статики, но лучше сосредоточиться на скорости загрузки информации по заказам, т.к. операторы уже подсветили эту проблему.

Важно иметь согласованные данные, т.к. операторам нужна самая актуальная информация по заказам, поэтому будем использовать read-/write-through подход при формировании кэшей.

Инвалидация кэша

Прогреваем кэш заказов каждый день перед началом работы операторов, у каждой записи есть TTL в 1-2 дня, чтобы вытеснять кэш по выполненным заказам.


```
@startuml

title Чтение и обновление заказа

actor op as "Operator"

participant ui as "CRM UI"
participant api as "CRM API"
database cache as "Redis"
database db as "shopDB"
database mb as "Message Broker"

== Обновление заказа ==

op -> ui : request update order

ui -> api: update order by id

api -> cache : updateOrder(orderId)

cache -> db : updateOrder(orderId)

db -> cache : order data

cache -> cache : upsert cache

cache --> api : order data

api --> ui : order data

ui --> op : response with updated order

mb -> api: new event for orderId

api -> cache : updateOrder(orderId)

cache -> db : updateOrder(orderId)

db -> cache : order data

cache -> cache : upsert cache



== Детали заказа ==

op -> ui: request order data

ui -> api: get order data

api -> cache: getOrder(orderId)

cache -[#0000FF]-> api: order data [cache hit]

api -[#0000FF]-> ui

ui -[#0000FF]-> op

cache [#red]-> db: getOrder(orderId)

db [#red]-> cache: order data

cache [#red]-> cache: insert cache

cache -[#red]-> api: order data

api -[#red]-> ui

ui -[#red]-> op: response with order data

@enduml
```